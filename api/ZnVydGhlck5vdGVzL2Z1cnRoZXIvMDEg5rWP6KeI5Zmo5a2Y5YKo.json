{"title":"æµè§ˆå™¨å­˜å‚¨è¯¦ç»†ç‰ˆ","date":"2021-11-19T16:00:00.000Z","date_formatted":{"ll":"Nov 20, 2021","L":"11/20/2021","MM-DD":"11-20"},"link":"furtherNotes/further/01 æµè§ˆå™¨å­˜å‚¨","tags":["JS","è®¡ç½‘"],"categories":["furtherNotes"],"updated":"2021-11-19T16:00:00.000Z","content":"<blockquote>\n<p>ç”±cwenjoy é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„ localStorage å¼•ç”³å‡ºæ¥çš„</p>\n<p><a href=\"https://www.jianshu.com/p/072e17112759\">https://www.jianshu.com/p/072e17112759</a></p>\n</blockquote>\n<h2 id=\"æµè§ˆå™¨å­˜å‚¨\">æµè§ˆå™¨å­˜å‚¨<a title=\"#æµè§ˆå™¨å­˜å‚¨\" href=\"#æµè§ˆå™¨å­˜å‚¨\"></a></h2>\n<h3 id=\"å¸¸è§çš„æµè§ˆå™¨æ•°æ®å­˜å‚¨æ–¹æ¡ˆ\">å¸¸è§çš„æµè§ˆå™¨æ•°æ®å­˜å‚¨æ–¹æ¡ˆ<a title=\"#å¸¸è§çš„æµè§ˆå™¨æ•°æ®å­˜å‚¨æ–¹æ¡ˆ\" href=\"#å¸¸è§çš„æµè§ˆå™¨æ•°æ®å­˜å‚¨æ–¹æ¡ˆ\"></a></h3>\n<ol>\n<li>Cookie</li>\n<li>Web å­˜å‚¨ ï¼šlocalStorage å’Œ sessionStorage</li>\n<li>IndexedDB</li>\n</ol>\n<h4 id=\"1.-cookie\">1. Cookie<a title=\"#1.-cookie\" href=\"#1.-cookie\"></a></h4>\n<h5 id=\"1.1-ç®€ä»‹\">1.1 ç®€ä»‹<a title=\"#1.1-ç®€ä»‹\" href=\"#1.1-ç®€ä»‹\"></a></h5>\n<p>Cookie åˆç§° HTTP Cookieï¼Œæœ€åˆåœ¨å®¢æˆ·ç«¯ç”¨äºå­˜å‚¨ä¼šè¯ä¿¡æ¯ï¼Œä»åº•å±‚çœ‹ï¼Œå…¶ä½œä¸º HTTP åè®®çš„ä¸€ç§æ‰©å±•å®ç°ï¼ŒCookie æ•°æ®ä¼šè‡ªåŠ¨åœ¨ Web æµè§ˆå™¨å’Œ Web æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“ï¼Œå› æ­¤åœ¨æœåŠ¡å™¨ç«¯è„šæœ¬å¯ä»¥è¯»å†™å­˜å‚¨çš„ cookie å€¼ï¼Œå› æ­¤ Cookie é€šå¸¸ç”¨æˆ·å­˜å‚¨ä¸€äº›é€šç”¨çš„æ•°æ®ã€‚</p>\n<h5 id=\"1.2-ä¼˜ç‚¹\">1.2 ä¼˜ç‚¹<a title=\"#1.2-ä¼˜ç‚¹\" href=\"#1.2-ä¼˜ç‚¹\"></a></h5>\n<p>ç›¸æ¯”äºå…¶ä»–çš„å­˜å‚¨æ–¹å¼ï¼Œ Cookie çš„å…¼å®¹æ€§å¾ˆå¥½</p>\n<h5 id=\"1.3-ç¼ºç‚¹\">1.3 ç¼ºç‚¹<a title=\"#1.3-ç¼ºç‚¹\" href=\"#1.3-ç¼ºç‚¹\"></a></h5>\n<ul>\n<li><strong>å­˜å‚¨é‡å°</strong>ï¼Œåœ¨ä¸åŒçš„æµè§ˆå™¨ä¸ŠåŸºæœ¬éƒ½æ˜¯ 4kb å¤§å°</li>\n<li><strong>å½±å“æ€§èƒ½</strong>ï¼ŒCookie ä¼šç”±æµè§ˆå™¨ä½œä¸ºè¯·æ±‚å¤´å‘é€ï¼Œå½“ Cookie å­˜å‚¨ä¿¡æ¯è¿‡å¤šæ—¶ï¼Œä¼šå½±å“ç‰¹å®šåŸŸçš„èµ„æºè·å–æ•ˆç‡ï¼Œå¢åŠ æ–‡ä»¶ä¼ è¾“çš„è´Ÿè½½</li>\n<li><strong>åªèƒ½å­˜å‚¨å­—ç¬¦ä¸²</strong></li>\n<li><strong>å®‰å…¨é—®é¢˜</strong>ï¼Œå­˜å‚¨åœ¨ Cookie çš„ä»»ä½•æ•°æ®å¯ä»¥è¢«ä»–äººè®¿é—®ï¼Œå› æ­¤ä¸èƒ½å† Cookie ä¸­å­˜å‚¨é‡è¦ä¿¡æ¯</li>\n<li>å› ä¸ºç¬¬ä¸‰æ–¹æ»¥ç”¨ Cookieï¼Œæ‰€ä»¥å¾ˆå¤šäººå†æµè§ˆç½‘é¡µæ—¶ä¼šç¦ç”¨ Cookieï¼Œæ‰€ä»¥å¾—æµ‹è¯•ç”¨æˆ·æ˜¯å¦æ”¯æŒ Cookie</li>\n</ul>\n<h5 id=\"1.4-æ“ä½œ\">1.4 æ“ä½œ<a title=\"#1.4-æ“ä½œ\" href=\"#1.4-æ“ä½œ\"></a></h5>\n<p>åŸºæœ¬æ“ä½œï¼šè¯»å–ã€å†™å…¥ã€åˆ é™¤ã€‚</p>\n<p>cookie ä¸­æ‰€æœ‰çš„åå­—å’Œå€¼éƒ½æ˜¯ç»è¿‡ URI ç¼–ç çš„ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨ decodeURICompoentæ¥è¿›è¡Œè§£ç æ‰èƒ½å¾—åˆ° cookie çš„å€¼ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">CookieUtil</span> = &#123;</span><br><span class=\"line\">    <span class=\"comment\">// getå¯æ ¹æ®cookieçš„åå­—è·å–ç›¸åº”çš„å€¼</span></span><br><span class=\"line\">    <span class=\"attr\">get</span>: <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> cookieName = encodeURIcOMPONET(name) + <span class=\"string\">&quot;=&quot;</span>,</span><br><span class=\"line\">               cookieStart = <span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span>.<span class=\"title function_\">indexOf</span>(cookieName),</span><br><span class=\"line\">               cookieValue = <span class=\"literal\">null</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(cookieStart &gt; -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> cookieEnd = <span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span>.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&quot;;&quot;</span>, cookieStart)</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(cookieEnd == -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                cookieEnd = <span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span>.<span class=\"property\">length</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            cookieValue = decodeURICompoent(<span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span>.<span class=\"title function_\">substring</span>(cookieStart + cookieName.<span class=\"property\">length</span>, cookieEnd))  </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cookieValue</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// setè®¾ç½®ä¸€ä¸ªcookie</span></span><br><span class=\"line\">    <span class=\"attr\">set</span>: <span class=\"keyword\">function</span>(<span class=\"params\">name, value, expires, path, domain, secure</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> cookieText = encodeURIComponet(name)+<span class=\"string\">&quot;=&quot;</span>+encodeURIComponet(value)</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(expires <span class=\"keyword\">instanceof</span> <span class=\"title class_\">Date</span>) &#123;</span><br><span class=\"line\">            cookieText += <span class=\"string\">&quot;; expires=&quot;</span> + expires.<span class=\"title function_\">toGMTString</span>()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(path) &#123;</span><br><span class=\"line\">            cookieText += <span class=\"string\">&quot;;path=&quot;</span> + path</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(domain) &#123;</span><br><span class=\"line\">            cookieText += <span class=\"string\">&quot;; domain&quot;</span> + domain</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(secure) &#123;</span><br><span class=\"line\">            cookieText += <span class=\"string\">&quot;; secure&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span> = cookieText</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// åˆ é™¤å·²æœ‰çš„cookie</span></span><br><span class=\"line\">    <span class=\"attr\">unset</span>: <span class=\"keyword\">function</span>(<span class=\"params\">name, path, domain, secure</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">set</span>(name, <span class=\"string\">&quot;&quot;</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>(<span class=\"number\">0</span>), path, domain, secure)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"2.-web-å­˜å‚¨\">2. Web å­˜å‚¨<a title=\"#2.-web-å­˜å‚¨\" href=\"#2.-web-å­˜å‚¨\"></a></h4>\n<p>web å­˜å‚¨æœºåˆ¶æœ€åˆä½œä¸º HTML5 çš„ä¸€éƒ¨åˆ†è¢«å®šä¹‰æˆ API çš„å½¢å¼ï¼Œä½†ç”±äºå…¶æœ¬èº«çš„ç‹¬ç‰¹æ€§äºä¸€äº›åŸå› è¢«å‰¥ç¦»å‡ºæ¥ï¼Œæˆä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ ‡å‡†ã€‚å…¶åŒ…æ‹¬ localStorage å¯¹è±¡ å’Œ sessionStorage å¯¹è±¡ã€‚</p>\n<p>å…¶äº§ç”Ÿçš„ä¸»è¦åŸå› ï¼š</p>\n<ol>\n<li>å¸Œæœ›æœ‰ä¸€ç§å† cookie ä¹‹å¤–å­˜å‚¨ä¼šè¯æ•°æ®çš„é€”å¾„</li>\n<li>å¸Œæœ›æœ‰ä¸€ç§å­˜å‚¨å¤§é‡å¯ä»¥è·¨ä¼šè¯å­˜åœ¨çš„æ•°æ®çš„æœºåˆ¶</li>\n</ol>\n<blockquote>\n<p>æœ€åˆçš„ web å­˜å‚¨è§„èŒƒä¸­åŒ…å«äº† sessionStorage å’Œ globalStorage ä¸¤ç§å¯¹è±¡çš„å®šä¹‰ï¼Œåœ¨æ”¯æŒè¿™ä¸¤ä¸ªå¯¹è±¡çš„æµè§ˆå™¨ä¸­éƒ½æ˜¯ä»¥ windows å¯¹è±¡å±æ€§çš„å½¢å¼å­˜åœ¨çš„</p>\n</blockquote>\n<h4 id=\"3.-localstorage\">3. localStorage<a title=\"#3.-localstorage\" href=\"#3.-localstorage\"></a></h4>\n<h5 id=\"3.1-ç®€ä»‹\">3.1 ç®€ä»‹<a title=\"#3.1-ç®€ä»‹\" href=\"#3.1-ç®€ä»‹\"></a></h5>\n<p>localStorage å¯¹è±¡ä½œä¸º <strong>æŒä¹…ä¿å­˜å®¢æˆ·ç«¯æ•°æ®</strong>çš„æ–¹æ¡ˆ å–ä»£äº† globalStorageã€‚</p>\n<p>ä»åŠŸèƒ½ä¸Šè®²ï¼Œå¯ä»¥é€šè¿‡ localStorage åœ¨æµè§ˆå™¨å­˜å‚¨é”®å€¼å¯¹æ•°æ®ï¼Œç›¸æ¯”äº cookieï¼Œæä¾›äº†æ›´ä¸ºç›´è§‚çš„ APIï¼Œåœ¨å®‰å…¨ä¸Šç›¸å¯¹å¥½ä¸€ç‚¹ã€‚</p>\n<p>è™½ç„¶ localStorage åªèƒ½å­˜å‚¨å­—ç¬¦ä¸²ï¼Œä½†ä¹Ÿå¯ä»¥å­˜å‚¨å­—ç¬¦ä¸²åŒ–çš„ JSON æ•°æ®ï¼Œå› æ­¤ç›¸æ¯” cookie ï¼ŒlocalStorage èƒ½å­˜å‚¨æ›´å¤æ‚çš„æ•°æ®ã€‚</p>\n<h5 id=\"3.2-ä¼˜ç‚¹\">3.2 ä¼˜ç‚¹<a title=\"#3.2-ä¼˜ç‚¹\" href=\"#3.2-ä¼˜ç‚¹\"></a></h5>\n<ul>\n<li>æä¾›äº†ç®€å•æ˜äº†çš„ API æ¥è¿›è¡Œæ“ä½œ</li>\n<li>æ›´åŠ å®‰å…¨</li>\n<li>å¯å­˜å‚¨çš„æ•°æ®é‡æ›´å¤§</li>\n</ul>\n<h5 id=\"3.3-è¯­æ³•\">3.3 è¯­æ³•<a title=\"#3.3-è¯­æ³•\" href=\"#3.3-è¯­æ³•\"></a></h5>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ä½¿ç”¨æ–¹æ³•å­˜å‚¨æ•°æ®</span></span><br><span class=\"line\"><span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;Srtian&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">// ä½¿ç”¨å±æ€§å­˜å‚¨æ•°æ®</span></span><br><span class=\"line\"><span class=\"variable language_\">localStorage</span>.<span class=\"property\">say</span> = <span class=\"string\">&quot;Hello world&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// ä½¿ç”¨æ–¹æ³•è¯»å–æ•°æ®</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> name = <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">getItem</span>(<span class=\"string\">&quot;name&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">// ä½¿ç”¨å±æ€§è¯»å–æ•°æ®</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> say = <span class=\"variable language_\">localStorage</span>.<span class=\"property\">say</span></span><br><span class=\"line\"><span class=\"comment\">// åˆ é™¤æ•°æ®</span></span><br><span class=\"line\"><span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">removeItem</span>(<span class=\"string\">&quot;name&quot;</span>)</span><br></pre></td></tr></table></figure>\n<p>éœ€è¦ä¼ è¾“å…¶ä»–æ ¼å¼çš„æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦å°†è¿™äº›æ•°æ®å…¨éƒ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ ¼å¼ï¼Œç„¶åå†è¿›è¡Œå­˜å‚¨</p>\n<p>è·å–å€¼æ—¶å°†å…¶è½¬åŒ–å›æ¥</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> user = &#123;<span class=\"attr\">name</span>:<span class=\"string\">&quot;Srtian&quot;</span>, <span class=\"attr\">age</span>: <span class=\"number\">22</span>&#125;</span><br><span class=\"line\"><span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&quot;user&quot;</span>, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(user))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> age = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(<span class=\"variable language_\">localStorage</span>.<span class=\"property\">user</span>)</span><br></pre></td></tr></table></figure>\n<h5 id=\"3.4-å­˜å‚¨æ•°æ®çš„æœ‰æ•ˆæœŸ-ä¸-ä½œç”¨åŸŸ\">3.4 å­˜å‚¨æ•°æ®çš„æœ‰æ•ˆæœŸ ä¸ ä½œç”¨åŸŸ<a title=\"#3.4-å­˜å‚¨æ•°æ®çš„æœ‰æ•ˆæœŸ-ä¸-ä½œç”¨åŸŸ\" href=\"#3.4-å­˜å‚¨æ•°æ®çš„æœ‰æ•ˆæœŸ-ä¸-ä½œç”¨åŸŸ\"></a></h5>\n<p>é€šè¿‡localStorageå­˜å‚¨çš„æ•°æ®æ—¶æ°¸ä¹…æ€§çš„ï¼Œé™¤éæˆ‘ä»¬ä½¿ç”¨removeItemæ¥åˆ é™¤æˆ–è€…ç”¨æˆ·é€šè¿‡è®¾ç½®æµè§ˆå™¨é…ç½®æ¥åˆ é™¤ï¼Œè´Ÿè´£æ•°æ®ä¼šä¸€ç›´ä¿ç•™åœ¨ç”¨æˆ·çš„ç”µè„‘ä¸Šï¼Œæ°¸ä¸è¿‡æœŸã€‚</p>\n<p>localStorageçš„ä½œç”¨åŸŸé™å®šåœ¨æ–‡æ¡£æºçº§åˆ«çš„ï¼ˆæ„æ€å°±æ˜¯åŒæºçš„æ‰èƒ½å…±äº«ï¼‰ï¼ŒåŒæºçš„æ–‡æ¡£é—´ä¼šå…±äº«localStorageçš„æ•°æ®ï¼Œä»–ä»¬å¯ä»¥äº’ç›¸è¯»å–å¯¹æ–¹çš„æ•°æ®ï¼Œç”šè‡³æœ‰æ—¶ä¼šè¦†ç›–å¯¹æ–¹çš„æ•°æ®ã€‚å½“ç„¶ï¼ŒlocalStorageçš„ä½œç”¨åŸŸåŒæ ·ä¹Ÿå—æµè§ˆå™¨çš„é™åˆ¶ã€‚</p>\n<h4 id=\"4.-sessionstorage\">4. sessionStorage<a title=\"#4.-sessionstorage\" href=\"#4.-sessionstorage\"></a></h4>\n<h5 id=\"4.1-ç®€ä»‹\">4.1 ç®€ä»‹<a title=\"#4.1-ç®€ä»‹\" href=\"#4.1-ç®€ä»‹\"></a></h5>\n<p>ä¸ localStorage ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äº localStorageé‡Œé¢å­˜å‚¨çš„æ•°æ®æ²¡æœ‰è¿‡æœŸæ—¶é—´è®¾ç½®ï¼Œè€ŒSession Storageåªå­˜å‚¨å½“å‰ä¼šè¯é¡µçš„æ•°æ®ï¼Œä¸”åªæœ‰å½“ç”¨æˆ·å…³é—­å½“å‰ä¼šè¯é¡µæˆ–æµè§ˆå™¨æ—¶ï¼Œæ•°æ®æ‰ä¼šè¢«æ¸…é™¤ã€‚</p>\n<h5 id=\"4.2-è¯­æ³•\">4.2 è¯­æ³•<a title=\"#4.2-è¯­æ³•\" href=\"#4.2-è¯­æ³•\"></a></h5>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ä¿å­˜æ•°æ®åˆ°sessionStorage</span></span><br><span class=\"line\">sessionStorage.<span class=\"title function_\">setItem</span>(<span class=\"string\">&#x27;name&#x27;</span>, <span class=\"string\">&#x27;Srtian&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ä»sessionStorageè·å–æ•°æ®</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> data = sessionStorage.<span class=\"title function_\">getItem</span>(<span class=\"string\">&#x27;name&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ä»sessionStorageåˆ é™¤ä¿å­˜çš„æ•°æ®</span></span><br><span class=\"line\">sessionStorage.<span class=\"title function_\">removeItem</span>(<span class=\"string\">&#x27;name&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ä»sessionStorageåˆ é™¤æ‰€æœ‰ä¿å­˜çš„æ•°æ®</span></span><br><span class=\"line\">sessionStorage.<span class=\"title function_\">clear</span>();</span><br></pre></td></tr></table></figure>\n<h4 id=\"5.-indexeddb\">5. indexedDB<a title=\"#5.-indexeddb\" href=\"#5.-indexeddb\"></a></h4>\n<h5 id=\"5.1-ç®€è¿°\">5.1 ç®€è¿°<a title=\"#5.1-ç®€è¿°\" href=\"#5.1-ç®€è¿°\"></a></h5>\n<p>ç”±HTML5æ‰€æä¾›çš„ä¸€ç§æœ¬åœ°å­˜å‚¨ï¼Œç”¨äºåœ¨æµè§ˆå™¨ä¸­å‚¨å­˜è¾ƒå¤§æ•°æ®ç»“æ„çš„ Web APIï¼Œå¹¶æä¾›ç´¢å¼•åŠŸèƒ½ä»¥å®ç°é«˜æ€§èƒ½æŸ¥æ‰¾ã€‚å®ƒä¸€èˆ¬ç”¨äºä¿å­˜å¤§é‡ç”¨æˆ·æ•°æ®å¹¶è¦æ±‚æ•°æ®ä¹‹é—´æœ‰æœç´¢éœ€è¦çš„åœºæ™¯ï¼Œå½“ç½‘ç»œæ–­å¼€æ—¶ï¼Œç”¨æˆ·å°±å¯ä»¥åšä¸€äº›ç¦»çº¿çš„æ“ä½œã€‚å®ƒè¾ƒä¹‹SQLæ›´ä¸ºæ–¹ä¾¿ï¼Œä¸éœ€è¦å†™ä¸€äº›ç‰¹å®šçš„è¯­æ³•å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼Œæ•°æ®æ ¼å¼æ˜¯JSONã€‚</p>\n<h5 id=\"5.2-è¯­æ³•\">5.2 è¯­æ³•<a title=\"#5.2-è¯­æ³•\" href=\"#5.2-è¯­æ³•\"></a></h5>\n<ol>\n<li>\n<p><strong>åˆ›å»ºæ•°æ®åº“ å¹¶ æŒ‡å®šæ•°æ®åº“ç‰ˆæœ¬å·</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æ³¨æ„æ•°æ®åº“çš„ç‰ˆæœ¬å·åªèƒ½æ˜¯æ•´æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> request = <span class=\"title class_\">IndexedDB</span>.<span class=\"title function_\">open</span>(databasename, version)</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p><strong>ç”Ÿæˆå¤„ç†å‡½æ•°</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">request.<span class=\"property\">onerror</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// åˆ›å»ºæ•°æ®åº“å¤±è´¥æ—¶çš„å›è°ƒå‡½æ•°</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">request.<span class=\"property\">onsuccess</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// åˆ›å»ºæ•°æ®åº“æˆåŠŸæ—¶çš„å›è°ƒå‡½æ•°</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">request.<span class=\"property\">onupgradeneededd</span> = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">     <span class=\"comment\">// å½“æ•°æ®åº“æ”¹å˜æ—¶çš„å›è°ƒå‡½æ•°   å”¯ä¸€å¯ä»¥ä¿®æ”¹æ•°æ®åº“ç»“æ„çš„åœ°æ–¹  å¯ä»¥åˆ›å»ºå’Œåˆ é™¤å¯¹è±¡å­˜å‚¨ç©ºé—´ä»¥åŠæ„å»ºå’Œåˆ é™¤ç´¢å¼•</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p><strong>å»ºç«‹å¯¹è±¡å­˜å‚¨ç©ºé—´</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å¯¹è±¡å­˜å‚¨ç©ºé—´ä»…è°ƒç”¨createObjectStore()å°±å¯ä»¥åˆ›å»ºã€‚è¿™ä¸ªæ–¹æ³•ä½¿ç”¨å­˜å‚¨ç©ºé—´çš„åç§°ï¼Œå’Œä¸€ä¸ªå¯¹è±¡å‚æ•°ã€‚å³ä¾¿è¿™ä¸ªå‚æ•°å¯¹è±¡æ˜¯å¯é€‰çš„ï¼Œå®ƒè¿˜æ˜¯éå¸¸é‡è¦çš„ï¼Œå› ä¸ºå®ƒå¯ä»¥è®©æˆ‘ä»¬å®šä¹‰é‡è¦çš„å¯é€‰å±æ€§å’Œå®Œå–„ä½ å¸Œæœ›åˆ›å»ºçš„å¯¹è±¡å­˜å‚¨ç©ºé—´çš„ç±»å‹ã€‚</span></span><br><span class=\"line\">request.<span class=\"property\">onupgradeneeded</span> = <span class=\"keyword\">function</span>(<span class=\"params\">event</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> db = event.<span class=\"property\">target</span>.<span class=\"property\">result</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> objectStore = db.<span class=\"title function_\">createObjectStore</span>(<span class=\"string\">&#x27;name&#x27;</span>, &#123; <span class=\"attr\">keyPath</span>:<span class=\"string\">&#x27;id&#x27;</span> &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p><strong>æ“ä½œæ•°æ®</strong></p>\n<ul>\n<li>\n<p>æ·»åŠ æ•°æ®</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">addData</span>: <span class=\"keyword\">function</span>(<span class=\"params\">db, storename, data</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> store = store = db.<span class=\"title function_\">transaction</span>(storename, <span class=\"string\">&#x27;readwrite&#x27;</span>).<span class=\"title function_\">objectStore</span>(storename)</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; data.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">!        <span class=\"keyword\">const</span> request = store.<span class=\"title function_\">add</span>(data[i])</span><br><span class=\"line\">        request.<span class=\"property\">onerror</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;æ·»åŠ æ•°æ®å¤±è´¥&#x27;</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        request.<span class=\"property\">onsuccess</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;æ·»åŠ æ•°æ®æˆåŠŸ&#x27;</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>ä¿®æ”¹æ•°æ®</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">putData</span>: <span class=\"keyword\">function</span>(<span class=\"params\">db, storename, data</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> store = store = db.<span class=\"title function_\">transaction</span>(storename, <span class=\"string\">&#x27;readwrite&#x27;</span>).<span class=\"title function_\">objectStore</span>(storename)</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; data.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">!        <span class=\"keyword\">const</span> request = store.<span class=\"title function_\">put</span>(data[i])</span><br><span class=\"line\">        request.<span class=\"property\">onerror</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;ä¿®æ”¹æ•°æ®å¤±è´¥&#x27;</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        request.<span class=\"property\">onsuccess</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;ä¿®æ”¹æ•°æ®æˆåŠŸ&#x27;</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>è·å–æ•°æ®</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">getDataByKey</span>: <span class=\"keyword\">function</span>(<span class=\"params\">db, storename, key</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> store = store = db.<span class=\"title function_\">transaction</span>(storename, <span class=\"string\">&#x27;readwrite&#x27;</span>).<span class=\"title function_\">objectStore</span>(storename)</span><br><span class=\"line\">!    <span class=\"keyword\">const</span> request = store.<span class=\"title function_\">get</span>(key)</span><br><span class=\"line\">    request.<span class=\"property\">onerror</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;è·å–æ•°æ®å¤±è´¥&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    request.<span class=\"property\">onsuccess</span> = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> result = e.<span class=\"property\">target</span>.<span class=\"property\">result</span></span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(result)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>åˆ é™¤æ•°æ®</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">deleteDate</span>: <span class=\"keyword\">function</span>(<span class=\"params\">db, storename, key</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> store = store = db.<span class=\"title function_\">transaction</span>(storename, <span class=\"string\">&#x27;readwrite&#x27;</span>).<span class=\"title function_\">objectStore</span>(storename)</span><br><span class=\"line\">!    store.<span class=\"title function_\">delete</span>(key)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;å·²åˆ é™¤å­˜å‚¨ç©ºé—´&#x27;</span> + storename + <span class=\"string\">&#x27;ä¸­çš„&#x27;</span> + key + <span class=\"string\">&#x27;çºªå½•&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>å…³é—­æ•°æ®åº“</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">close</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ol>\n<h5 id=\"5.3-ä¼˜ç‚¹-ä¸å…¶ä»–ç›¸æ¯”\">5.3 ä¼˜ç‚¹ ä¸å…¶ä»–ç›¸æ¯”<a title=\"#5.3-ä¼˜ç‚¹-ä¸å…¶ä»–ç›¸æ¯”\" href=\"#5.3-ä¼˜ç‚¹-ä¸å…¶ä»–ç›¸æ¯”\"></a></h5>\n<ul>\n<li>æ‹¥æœ‰æ›´å¤§çš„å­˜å‚¨ç©ºé—´</li>\n<li>èƒ½å¤Ÿå¤„ç†æ›´ä¸ºå¤æ‚å’Œç»“æ„åŒ–çš„æ•°æ®</li>\n<li>æ‹¥æœ‰æ›´å¤šçš„äº¤äº’æ§åˆ¶</li>\n<li>æ¯ä¸ª database ä¸­å¯ä»¥æ‹¥æœ‰å¤šä¸ª database å’Œ table</li>\n</ul>\n<h5 id=\"5.4-å±€é™æ€§\">5.4 å±€é™æ€§<a title=\"#5.4-å±€é™æ€§\" href=\"#5.4-å±€é™æ€§\"></a></h5>\n<ul>\n<li><strong>å­˜å‚¨ç©ºé—´é™åˆ¶</strong>ï¼šä¸€ä¸ªå•ç‹¬çš„æ•°æ®åº“é¡¹ç›®å¤§å°æ²¡æœ‰é™åˆ¶ï¼Œä½†å¯èƒ½ä¼šé™åˆ¶æ¯ä¸ª IndexedDB æ•°æ®åº“çš„å¤§å°ï¼Œä¸åŒæµè§ˆå™¨æœ‰ä¸åŒé™åˆ¶ï¼›</li>\n<li><strong>å…¼å®¹æ€§é—®é¢˜</strong>ï¼šå…¼å®¹æ€§æ¯”å‰é¢æåŠçš„å­˜å‚¨æ–¹æ¡ˆå·®</li>\n<li><strong>å—åŒæºç­–ç•¥é™åˆ¶</strong>ï¼šæŠŠå­˜å‚¨ç©ºé—´ç»‘å®šåˆ°äº†åˆ›å»ºå®ƒçš„ç«™ç‚¹çš„æºï¼Œæ‰€ä»¥ä¸èƒ½è¢«å…¶ä»–æºè®¿é—®</li>\n</ul>\n","prev":{"title":"PromiseåŸºæœ¬ç”¨æ³•","link":"furtherNotes/further/03 Promise"},"next":{"title":"å›è°ƒåœ°ç‹±åŠå…¶è§£å†³æ–¹æ¡ˆ","link":"furtherNotes/further/03 å›è°ƒåœ°ç‹±è§£å†³"},"plink":"https://shylees.github.io/furtherNotes/further/01 æµè§ˆå™¨å­˜å‚¨/","toc":[{"id":"æµè§ˆå™¨å­˜å‚¨","title":"æµè§ˆå™¨å­˜å‚¨","index":"1","children":[{"id":"å¸¸è§çš„æµè§ˆå™¨æ•°æ®å­˜å‚¨æ–¹æ¡ˆ","title":"å¸¸è§çš„æµè§ˆå™¨æ•°æ®å­˜å‚¨æ–¹æ¡ˆ","index":"1.1"}]}],"copyright":{"custom":"ä¸è®¸è½¬è½½ğŸ˜¡ï¼ï¼ï¼"},"reading_time":"2045 words in 10 min"}