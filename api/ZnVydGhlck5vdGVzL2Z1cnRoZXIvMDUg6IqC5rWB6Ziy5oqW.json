{"title":"节流throttle、防抖debounce","date":"2021-11-12T16:00:00.000Z","date_formatted":{"ll":"Nov 13, 2021","L":"11/13/2021","MM-DD":"11-13"},"link":"furtherNotes/further/05 节流防抖","tags":["js"],"categories":["furtherNotes"],"updated":"2021-11-12T16:00:00.000Z","content":"<blockquote>\n<p>参考链接：</p>\n<p><a href=\"https://www.jianshu.com/p/566c66aafa22\">https://www.jianshu.com/p/566c66aafa22</a></p>\n<p><a href=\"https://juejin.cn/post/6959161295358656520\">https://juejin.cn/post/6959161295358656520</a></p>\n</blockquote>\n<h3 id=\"1.-概念\">1. 概念<a title=\"#1.-概念\" href=\"#1.-概念\"></a></h3>\n<h4 id=\"1.1-应用场景\">1.1 应用场景<a title=\"#1.1-应用场景\" href=\"#1.1-应用场景\"></a></h4>\n<p>高频触发事件时，可能会频繁执行DOM操作，资源加载等，导致UI停顿甚至浏览器崩溃。</p>\n<ul>\n<li>window对象频繁的 <code>onresize</code>，<code>onscroll</code>等事件</li>\n<li>拖拽的 mousemove 事件</li>\n<li>射击游戏的 mousedown，keydown 事件</li>\n<li>文字输入，自动完成的 keyup 事件</li>\n</ul>\n<h4 id=\"1.2-解决方案\">1.2 解决方案<a title=\"#1.2-解决方案\" href=\"#1.2-解决方案\"></a></h4>\n<p>对于 window 和 resize 事件，实际需求大多为停止改变大于 n 毫秒后执行后续处理；而其他事件大多数的需求是以一定的频率执行后续处理。</p>\n<blockquote>\n<p>针对这两种需求出现了 debounce 和 throttle 两种方式</p>\n</blockquote>\n<h4 id=\"1.3-节流\">1.3 节流<a title=\"#1.3-节流\" href=\"#1.3-节流\"></a></h4>\n<p>高频事件触发，<strong>但在 n 秒<font color='red'>内</font>只会执行一次</strong>，所以节流会稀释函数的执行频率</p>\n<blockquote>\n<p>比如mouseover，resize这种事件，每当有变化的时候，就会触发一次函数，这样很浪费资源。就比如一个持续流水的水龙头，水龙头开到最大的时候很浪费水资源，将水龙头开得小一点，让他每隔200毫秒流出一滴水，这样能源源不断的流出水而又不浪费。</p>\n<p>常见例子：即时查询、不断点击、监听滚动事件触底事件</p>\n</blockquote>\n<h4 id=\"1.4-防抖\">1.4 防抖<a title=\"#1.4-防抖\" href=\"#1.4-防抖\"></a></h4>\n<p><strong>触发高频事件<font color='red'>后 </font>n 秒内函数只会执行一次</strong>，如果n秒内高频事件再次被触发，则重新计算时间</p>\n<blockquote>\n<p>A和B说话，A一直bbbbbb，当A持续说了一段时间的话后停止讲话，过了10秒之后，我们判定A讲完了，B开始回答A的话；如果10秒内A又继续讲话，那么我们判定A没讲完，B不响应，等A再次停止后，我们再次计算停止的时间，如果超过10秒B响应，如果没有则B不响应。</p>\n<p>常见例子：点击按钮、拍照、下拉触底加载下一页等、search 搜索联想、window 触发 resize</p>\n</blockquote>\n<h4 id=\"1.5-防抖和节流的区别\">1.5 防抖和节流的区别<a title=\"#1.5-防抖和节流的区别\" href=\"#1.5-防抖和节流的区别\"></a></h4>\n<ul>\n<li>函数防抖和函数节流都是防止某一时间内频繁触发。</li>\n<li>函数防抖是在指定时间只执行一次，而函数节流是每到指定间隔时间执行一次。</li>\n<li>函数防抖是将几次操作合并为一次操作进行，函数节流使得一定时间内只触发一次函数。</li>\n</ul>\n<h3 id=\"2.-实现\">2. 实现<a title=\"#2.-实现\" href=\"#2.-实现\"></a></h3>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span> 无处理输入:<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;non&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span> 立即防抖处理输入:<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;imdebounce&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span> 非立即防抖处理输入:<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;unimdebounce&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span> 整合防抖处理输入:<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;bothdebounce&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span> 时间戳节流处理输入:<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;stampthrottle&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span> 定时器节流处理输入:<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;timeoutthrottle&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">function</span> <span class=\"title function_\">pri</span>(<span class=\"params\">obj</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(obj.<span class=\"property\">value</span> + <span class=\"string\">&quot; &quot;</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>());</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">const</span> non = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;.non&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">  non.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;keyup&#x27;</span>, <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">pri</span>(e.<span class=\"property\">target</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">   ...</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"2.1-节流\">2.1 节流<a title=\"#2.1-节流\" href=\"#2.1-节流\"></a></h4>\n<blockquote>\n<p>使得一定时间内只触发一次函数。原理是通过判断是否有延迟调用函数未执行。</p>\n</blockquote>\n<ul>\n<li><strong>定时器：</strong> 函数触发是在时间段内结束的时候</li>\n<li><strong>时间戳：</strong> 函数触发是在时间段内开始的时候</li>\n</ul>\n<h5 id=\"2.1.1-定时器节流\">2.1.1 定时器节流<a title=\"#2.1.1-定时器节流\" href=\"#2.1.1-定时器节流\"></a></h5>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> timenode = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;.timeoutthrottle&#x27;</span>);</span><br><span class=\"line\"> <span class=\"comment\">// 定时器</span></span><br><span class=\"line\"> <span class=\"keyword\">function</span> <span class=\"title function_\">timethrottle</span>(<span class=\"params\">func, delay</span>) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">let</span> canrun;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"keyword\">function</span> (<span class=\"params\"><span class=\"variable language_\">arguments</span></span>) &#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (!canrun) &#123;</span><br><span class=\"line\">       canrun = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">         func.<span class=\"title function_\">call</span>(<span class=\"variable language_\">this</span>, <span class=\"variable language_\">arguments</span>)</span><br><span class=\"line\">         canrun = <span class=\"literal\">null</span>;</span><br><span class=\"line\">       &#125;, delay)</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"keyword\">const</span> time = <span class=\"title function_\">timethrottle</span>(pri, <span class=\"number\">500</span>);</span><br><span class=\"line\"> timenode.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;keyup&#x27;</span>, <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">   <span class=\"title function_\">time</span>(e.<span class=\"property\">target</span>)</span><br><span class=\"line\"> &#125;)</span><br></pre></td></tr></table></figure>\n<h5 id=\"2.1.2-时间戳节流\">2.1.2 时间戳节流<a title=\"#2.1.2-时间戳节流\" href=\"#2.1.2-时间戳节流\"></a></h5>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> stampnode = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;.stampthrottle&#x27;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 时间戳</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">stampthrottle</span>(<span class=\"params\">func, delay</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> pre = <span class=\"number\">0</span>;    <span class=\"comment\">//上一次记录时间</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">function</span> (<span class=\"params\"><span class=\"variable language_\">arguments</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> now = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (now - pre &gt;= delay) &#123;</span><br><span class=\"line\">      func.<span class=\"title function_\">call</span>(<span class=\"variable language_\">this</span>, <span class=\"variable language_\">arguments</span>); <span class=\"comment\">//当前时间 - 上次时间 &gt; 延时时间</span></span><br><span class=\"line\">      pre = now;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> stamp = <span class=\"title function_\">stampthrottle</span>(pri, <span class=\"number\">500</span>);</span><br><span class=\"line\">stampnode.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;keyup&#x27;</span>, <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">stamp</span>(e.<span class=\"property\">target</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h4 id=\"2.2-防抖\">2.2 防抖<a title=\"#2.2-防抖\" href=\"#2.2-防抖\"></a></h4>\n<blockquote>\n<p>将多次操作合并为一次操作进行。原理是维护一个计时器，规定在delay时间后触发函数，但是在delay时间内再次触发的话，就会取消之前的计时器而重新设置。</p>\n</blockquote>\n<ul>\n<li>\n<p>**非立即防抖：**指的是触发事件后函数不会立即执行，而是在 n 秒后执行，如果在 n 秒内又触发了事件，则会重新计算函数执行时间。</p>\n</li>\n<li>\n<p><strong>立即防抖：</strong> 指的是触发事件后函数会立即执行，然后 n 秒内不触发事件才能继续执行函数的效果。</p>\n<p>简而言之，立即执行版就是第一次事件触发后会立即执行，至少执行一次事件。</p>\n</li>\n</ul>\n<h5 id=\"2.2.1-立即防抖\">2.2.1 立即防抖<a title=\"#2.2.1-立即防抖\" href=\"#2.2.1-立即防抖\"></a></h5>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> imnode = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;.imdebounce&#x27;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 立即防抖</span></span><br><span class=\"line\"><span class=\"comment\">// 指的是触发事件后函数会立即执行，n 秒内不触发事件才能继续执行函数的效果</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">imdebounce</span>(<span class=\"params\">func, delay</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> timeout;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">function</span> (<span class=\"params\"><span class=\"variable language_\">arguments</span></span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (timeout) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">clearTimeout</span>(timeout);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> flag = !timeout;</span><br><span class=\"line\">    timeout = <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// func.call(this, arguments);</span></span><br><span class=\"line\">      timeout = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;, delay)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (flag) &#123;</span><br><span class=\"line\">      func.<span class=\"title function_\">call</span>(<span class=\"variable language_\">this</span>, <span class=\"variable language_\">arguments</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> im = <span class=\"title function_\">imdebounce</span>(pri, <span class=\"number\">500</span>);</span><br><span class=\"line\">imnode.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;keyup&#x27;</span>, <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// ; debugger</span></span><br><span class=\"line\">  <span class=\"comment\">// imdebounce(pri, 500)(e.target)   //就不可以为什么</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"title function_\">im</span>(e.<span class=\"property\">target</span>);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h5 id=\"2.2.2-非立即防抖\">2.2.2 非立即防抖<a title=\"#2.2.2-非立即防抖\" href=\"#2.2.2-非立即防抖\"></a></h5>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> unimnode = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;.unimdebounce&#x27;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 非立即防抖</span></span><br><span class=\"line\"><span class=\"comment\">// 高频触发时 如果 触发后 delay 没有再触发 就执行函数</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unimdebounce</span>(<span class=\"params\">func, delay</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> timeout;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">function</span> (<span class=\"params\"><span class=\"variable language_\">arguments</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (timeout) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">clearTimeout</span>(timeout);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    timeout = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      func.<span class=\"title function_\">call</span>(<span class=\"variable language_\">this</span>, <span class=\"variable language_\">arguments</span>);</span><br><span class=\"line\">      timeout = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;, delay)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> un = <span class=\"title function_\">unimdebounce</span>(pri, <span class=\"number\">500</span>);</span><br><span class=\"line\">unimnode.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;keyup&#x27;</span>, <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">un</span>(e.<span class=\"property\">target</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h5 id=\"2.2.3-结合版\">2.2.3 结合版<a title=\"#2.2.3-结合版\" href=\"#2.2.3-结合版\"></a></h5>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> bothnode = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;.bothdebounce&#x27;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 结合版</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">debounce</span>(<span class=\"params\">func, delay = <span class=\"number\">500</span>, immediate = <span class=\"literal\">true</span></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> timeout;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">function</span> (<span class=\"params\"><span class=\"variable language_\">arguments</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (timeout) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">clearTimeout</span>(timeout);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (immediate) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 立即执行</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> flag = !timeout;</span><br><span class=\"line\">      timeout = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        timeout = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      &#125;, delay)</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (flag) &#123;</span><br><span class=\"line\">        func.<span class=\"title function_\">call</span>(<span class=\"variable language_\">this</span>, <span class=\"variable language_\">arguments</span>)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 非立即执行</span></span><br><span class=\"line\">      timeout = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        func.<span class=\"title function_\">call</span>(<span class=\"variable language_\">this</span>, <span class=\"variable language_\">arguments</span>);</span><br><span class=\"line\">        timeout = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      &#125;, delay)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> both = <span class=\"title function_\">debounce</span>(pri, <span class=\"number\">500</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">bothnode.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;keyup&#x27;</span>, <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">both</span>(e.<span class=\"property\">target</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n","prev":{"title":"滚轮事件","link":"furtherNotes/further/04 滚轮事件"},"next":{"title":"HTTP 常见状态码","link":"furtherNotes/further/02 常见状态码"},"plink":"https://shylees.github.io/furtherNotes/further/05 节流防抖/","toc":[{"id":"1.-概念","title":"1. 概念","index":"1"},{"id":"2.-实现","title":"2. 实现","index":"2"}],"copyright":{"custom":"不许转载😡！！！"},"reading_time":"1501 words in 8 min"}