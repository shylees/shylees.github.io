{"title":"æ·±æ‹·è´æµ…æ‹·è´","date":"2021-12-13T16:00:00.000Z","date_formatted":{"ll":"Dec 14, 2021","L":"12/14/2021","MM-DD":"12-14"},"link":"furtherNotes/further/01 æ·±æ‹·è´æµ…æ‹·è´","tags":["JS"],"categories":["furtherNotes"],"updated":"2021-12-13T16:00:00.000Z","content":"<blockquote>\n<p>é¢è¯•ä¸“æ ï¼š<a href=\"https://vue3js.cn/interview/JavaScript/copy.html#%E4%B8%80%E3%80%81%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%AD%98%E5%82%A8\">https://vue3js.cn/interview/JavaScript/copy.html#ä¸€ã€æ•°æ®ç±»å‹å­˜å‚¨</a></p>\n<p>æ·±æ‹·è´æµ…æ‹·è´ï¼š<a href=\"https://juejin.cn/post/7013603488315736072\">https://juejin.cn/post/7013603488315736072</a></p>\n<p>messagechannelï¼š<a href=\"https://www.jianshu.com/p/4f07ef18b5d7\">https://www.jianshu.com/p/4f07ef18b5d7</a></p>\n<p>æ·±æ‹·è´å‡½æ•°ï¼š<a href=\"https://www.cnblogs.com/wangyong1997/p/13577725.html\">https://www.cnblogs.com/wangyong1997/p/13577725.html</a></p>\n</blockquote>\n<h2 id=\"æ·±æ‹·è´-ä¸-æµ…æ‹·è´\">æ·±æ‹·è´ ä¸ æµ…æ‹·è´<a title=\"#æ·±æ‹·è´-ä¸-æµ…æ‹·è´\" href=\"#æ·±æ‹·è´-ä¸-æµ…æ‹·è´\"></a></h2>\n<p>åœ¨æ—¥å¸¸ç”Ÿ\täº§ç¯å¢ƒå½“ä¸­ï¼Œä½¿ç”¨å®Œç¾æ–¹æ¡ˆâ€”<code>lodash.cloneDeep</code>ï¼Œé¢è¯•é—®èµ·æ¥çš„è¯ï¼Œé‡ç‚¹ä½¿ç”¨é€’å½’å®ç°ï¼ŒJSONã€Object.assginã€MessageChanneléƒ½å¯ä»¥ä½œä¸ºè¡¥å……ã€‚</p>\n<h3 id=\"1.-æ•°æ®ç±»å‹å­˜å‚¨\">1. æ•°æ®ç±»å‹å­˜å‚¨<a title=\"#1.-æ•°æ®ç±»å‹å­˜å‚¨\" href=\"#1.-æ•°æ®ç±»å‹å­˜å‚¨\"></a></h3>\n<ul>\n<li>\n<p>åŸºæœ¬ç±»å‹ï¼šæ ˆå†…å­˜</p>\n<blockquote>\n<p>numberã€nullã€undefinedã€booleanã€stringã€symbolã€bigint</p>\n</blockquote>\n</li>\n<li>\n<p>å¼•ç”¨ç±»å‹ï¼šå †å†…å­˜ï¼Œå¼•ç”¨æ•°æ®ç±»å‹çš„å˜é‡æ˜¯ä¸€ä¸ªæŒ‡å‘å †å†…å­˜ä¸­äº‹å¯¹è±¡çš„å¼•ç”¨ï¼Œå­˜åœ¨æ ˆä¸­</p>\n<blockquote>\n<p>functionã€objectã€arrayã€dateã€regexpã€mapã€set</p>\n</blockquote>\n</li>\n<li>\n<p>æµ…æ‹·è´ï¼šåŸºæœ¬ç±»å‹ï¼Œæ‹·è´æ•°æ®ï¼›å¼•ç”¨ç±»å‹ï¼Œæ‹·è´å†…å­˜åœ°å€ï¼›å³å…±ç”¨å¼•ç”¨ç±»å‹æ•°æ®ã€‚</p>\n<blockquote>\n<p><code>=</code> ä»ç¬¬ä¸€å±‚çš„å¼•ç”¨ç±»å‹å°±æ˜¯å…±äº«å†…å­˜åœ°å€</p>\n<p>æµ…æ‹·è´æ˜¯<strong>æ‹·è´ä¸€å±‚</strong>ï¼Œæ·±å±‚æ¬¡çš„å¼•ç”¨ç±»å‹åˆ™å…±äº«å†…å­˜åœ°å€</p>\n<p><strong>ä¿®æ”¹ç¬¬ä¸€å±‚çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ˜¯ä¸ä¼šä¿®æ”¹åˆ°å…¶ä»–å¯¹è±¡çš„ï¼›</strong></p>\n<p><strong>ä½†æ˜¯ä¿®æ”¹ç¬¬ä¸€å±‚å¼•ç”¨ç±»å‹ä¸‹é¢çš„å€¼æ—¶ï¼Œå…¨éƒ½æ˜¯åœ¨æ“ä½œä¸€ä¸ªå†…å­˜åœ°å€çš„å€¼</strong></p>\n</blockquote>\n</li>\n<li>\n<p>æ·±æ‹·è´ï¼šåŸºæœ¬ç±»å‹ å’Œ å¼•ç”¨ç±»å‹éƒ½æ‹·è´æ•°æ®ï¼Œä¸å­˜åœ¨å…±ç”¨æ•°æ®çš„ç°è±¡</p>\n<blockquote>\n<p>ä¿®æ”¹ä»»ä½•å¯¹è±¡çš„å±æ€§éƒ½ä¸ä¼šæ”¹å˜å¦ä¸€ä¸ªå¯¹è±¡çš„å±æ€§</p>\n</blockquote>\n</li>\n</ul>\n<p>å‰æä¸ºæ‹·è´ç±»å‹ä¸ºå¼•ç”¨ç±»å‹çš„æƒ…å†µä¸‹ï¼š</p>\n<ul>\n<li>æµ…æ‹·è´æ˜¯æ‹·è´ä¸€å±‚ï¼Œå±æ€§ä¸ºå¯¹è±¡æ—¶ï¼Œæµ…æ‹·è´æ˜¯å¤åˆ¶ï¼Œä¸¤ä¸ªå¯¹è±¡æŒ‡å‘åŒä¸€ä¸ªåœ°å€</li>\n<li>æ·±æ‹·è´æ˜¯é€’å½’æ‹·è´æ·±å±‚æ¬¡ï¼Œå±æ€§ä¸ºå¯¹è±¡æ—¶ï¼Œæ·±æ‹·è´æ˜¯æ–°å¼€æ ˆï¼Œä¸¤ä¸ªå¯¹è±¡æŒ‡å‘ä¸åŒçš„åœ°å€</li>\n</ul>\n<h3 id=\"2.-æµ…æ‹·è´\">2. æµ…æ‹·è´<a title=\"#2.-æµ…æ‹·è´\" href=\"#2.-æµ…æ‹·è´\"></a></h3>\n<ol>\n<li><code>Object.assign(target,source[,source2])</code>  // Object Array</li>\n<li>æ‰©å±•è¿ç®—ç¬¦ <code>...</code>  // Object Array</li>\n<li><code>Array.prototype.slice --- arrO.slice(0)</code>  // Array</li>\n<li><code>Array.prototype.concat --- arrO.concat()</code> // Array</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>:<span class=\"string\">&#x27;aaa1&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">b</span>:&#123;</span><br><span class=\"line\">        <span class=\"attr\">b1</span>:<span class=\"string\">&#x27;bbb1&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> arr = [<span class=\"number\">0</span>,[<span class=\"number\">10</span>,<span class=\"number\">11</span>]]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// =</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> obj2 = obj;</span><br><span class=\"line\">obj2.<span class=\"property\">a</span> = <span class=\"string\">&#x27;aaa2&#x27;</span>; <span class=\"comment\">// obj2.a === obj.a = &#x27;aaa2&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// assign</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> obj3 = <span class=\"title class_\">Object</span>.<span class=\"title function_\">assign</span>(&#123;&#125;,obj);</span><br><span class=\"line\">obj3.<span class=\"property\">a</span> = <span class=\"string\">&#x27;aaa3&#x27;</span>;     <span class=\"comment\">// obj3.a = &#x27;aaa3&#x27;  obj.a = &#x27;aaa2&#x27;  // obj.a åŸºæœ¬ç±»å‹</span></span><br><span class=\"line\">obj3.<span class=\"property\">b</span>.<span class=\"property\">b1</span> = <span class=\"string\">&#x27;bbb3&#x27;</span>;  <span class=\"comment\">// obj3.b === obj.b = &#123; b1: &#x27;bbb3&#x27;&#125;  // obj è·Ÿç€å˜åŒ–</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ...</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> obj4 = &#123;...obj&#125;;</span><br><span class=\"line\">obj4.<span class=\"property\">a</span> = <span class=\"string\">&#x27;aaa4&#x27;</span>;    <span class=\"comment\">// obj.a = &#x27;aaa2&#x27; obj4.a = &#x27;aaa4&#x27;</span></span><br><span class=\"line\">obj4.<span class=\"property\">b</span>.<span class=\"property\">b1</span> = <span class=\"string\">&#x27;bbb4&#x27;</span>; <span class=\"comment\">// obj.b.b1 === obj4.b.b1 = &#x27;bbb4&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// slice</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> arr2 = arr.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">arr2[<span class=\"number\">0</span>] = <span class=\"number\">20</span>;    <span class=\"comment\">// arr2[0] = 20  arr[0] = 0</span></span><br><span class=\"line\">arr2[<span class=\"number\">1</span>][<span class=\"number\">1</span>] = <span class=\"number\">22</span>; <span class=\"comment\">// arr[1] === arr2[1] = [11,22];</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//concat</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> arr3 = arr.<span class=\"title function_\">concat</span>();</span><br></pre></td></tr></table></figure>\n<h3 id=\"3.-æ·±æ‹·è´\">3. æ·±æ‹·è´<a title=\"#3.-æ·±æ‹·è´\" href=\"#3.-æ·±æ‹·è´\"></a></h3>\n<ol>\n<li><code>JSON.parse(JSON.stringify())</code></li>\n<li><code>Jquery.extend()</code></li>\n<li><code>_.cloneDeep()</code></li>\n<li><code>MessageChannel</code></li>\n<li>æ‰‹å†™å¾ªç¯é€’å½’</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// JSON.parse(JSON.stringify(obj))</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> obj5 = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(obj))</span><br><span class=\"line\">obj5.<span class=\"property\">a</span> = <span class=\"string\">&#x27;aaa5&#x27;</span>;     <span class=\"comment\">// obj5.a = &#x27;aaa5&#x27; obj.a = &#x27;aaa2&#x27;</span></span><br><span class=\"line\">obj5.<span class=\"property\">b</span>.<span class=\"property\">b1</span> = <span class=\"string\">&#x27;bbb5&#x27;</span>;  <span class=\"comment\">// obj5.b.b1 = &#x27;bbb5&#x27;  obj.b.b1 = &#x27;bbb4&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// jquery.extend</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> $ = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;jquery&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> obj6 = $.<span class=\"title function_\">extend</span>(<span class=\"literal\">true</span>, &#123;&#125;, obj);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// _.cloneDeep</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> _ = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;lodash&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> obj7 = _.<span class=\"title function_\">cloneDeep</span>(obj)</span><br></pre></td></tr></table></figure>\n<p>JSON.parse çš„é—®é¢˜ï¼š</p>\n<ul>\n<li>ä¼šå¿½ç•¥ <code>undefined</code> å’Œ <code>symbol</code></li>\n<li>ä¸å¯ä»¥å¯¹ <code>Function </code> è¿›è¡Œæ‹·è´ï¼Œå› ä¸º JSON æ ¼å¼å­—ç¬¦ä¸²ä¸æ”¯æŒ Functionï¼Œåœ¨åºåˆ—åŒ–æ—¶ä¼šè‡ªåŠ¨åˆ é™¤</li>\n<li>ä¸æ”¯æŒå¾ªç¯å¯¹è±¡çš„æ‹·è´ï¼ˆå¯¹è±¡çš„æŸä¸ªå±æ€§çš„å€¼ä¸ºå…¶è‡ªå·±ï¼‰</li>\n<li>ä¸èƒ½æ­£ç¡®å¤„ç†new Date</li>\n<li>ä¸èƒ½å¤„ç†æ­£åˆ™</li>\n<li>ä¸èƒ½å¤„ç† new Error()</li>\n</ul>\n<p>ä½†é‡åˆ°çš„æ·±æ‹·è´çš„åœºæ™¯å¾ˆå°‘ï¼Œè€Œä¸” 99% ç”¨ JSON.stringify å°±å¯ä»¥è§£å†³</p>\n<h5 id=\"3.-!-_.clonedeep\">3. ! <code>_.cloneDeep</code><a title=\"#3.-!-_.clonedeep\" href=\"#3.-!-_.clonedeep\"></a></h5>\n<blockquote>\n<p>è¿™æ˜¯æœ€æœ€æœ€æœ€å®Œç¾çš„æ·±æ‹·è´çš„æ–¹å¼ï¼Œå®ƒå·²ç»å°†ä¼šå‡ºç°é—®é¢˜çš„å„ç§æƒ…å†µéƒ½è€ƒè™‘åœ¨å†…äº†ï¼Œæ‰€ä»¥åœ¨æ—¥å¸¸é¡¹ç›®å¼€å‘å½“ä¸­ï¼Œå»ºè®®ä½¿ç”¨è¿™ç§æˆç†Ÿçš„è§£å†³æ–¹æ¡ˆ.</p>\n<p>å…¶å®lodashè§£å†³å¾ªç¯å¼•ç”¨çš„æ–¹å¼ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªæ ˆè®°å½•æ‰€æœ‰è¢«æ‹·è´çš„å¼•ç”¨å€¼ï¼Œå¦‚æœå†æ¬¡ç¢°åˆ°åŒæ ·çš„å¼•ç”¨å€¼çš„æ—¶å€™ï¼Œä¸ä¼šå†å»æ‹·è´ä¸€éï¼Œè€Œæ˜¯åˆ©ç”¨ä¹‹å‰å·²ç»æ‹·è´å¥½çš„ã€‚</p>\n</blockquote>\n<h5 id=\"4.messagechannel\">4.<code>MessageChannel</code><a title=\"#4.messagechannel\" href=\"#4.messagechannel\"></a></h5>\n<p>MessageChannel å…è®¸æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æ¶ˆæ¯é€šé“ï¼Œå¹¶é€šè¿‡å…¶ postMessage å‘é€æ•°æ®ï¼Œommessage æ¥æ”¶æ•°æ®</p>\n<blockquote>\n<p>ç®€å•æ¥è¯´ï¼Œ<code>MessageChannel</code>åˆ›å»ºäº†ä¸€ä¸ªé€šä¿¡çš„ç®¡é“ï¼Œè¿™ä¸ªç®¡é“æœ‰ä¸¤ä¸ªç«¯å£ï¼Œæ¯ä¸ªç«¯å£éƒ½å¯ä»¥é€šè¿‡<code>postMessage</code>å‘é€æ•°æ®ï¼Œè€Œä¸€ä¸ªç«¯å£åªè¦ç»‘å®šäº†<code>onmessage</code>å›è°ƒæ–¹æ³•ï¼Œå°±å¯ä»¥æ¥æ”¶ä»å¦ä¸€ä¸ªç«¯å£ä¼ è¿‡æ¥çš„æ•°æ®ã€‚</p>\n</blockquote>\n<h6 id=\"4.1-ä½¿ç”¨-messagechannel\">4.1 ä½¿ç”¨ MessageChannel<a title=\"#4.1-ä½¿ç”¨-messagechannel\" href=\"#4.1-ä½¿ç”¨-messagechannel\"></a></h6>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> channel = <span class=\"keyword\">new</span> <span class=\"title class_\">MessageChannel</span>();   <span class=\"comment\">// åˆ›å»ºäº†ä¸€ä¸ªç®¡é“</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> port1 = channel.<span class=\"property\">port1</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> port2 = channel.<span class=\"property\">port2</span>;             <span class=\"comment\">// è·å–å®ä¾‹çš„ä¸¤ä¸ªç«¯å£ åªè¯»</span></span><br><span class=\"line\">port1.<span class=\"property\">onmessage</span> = <span class=\"keyword\">function</span>(<span class=\"params\">event</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;port1æ”¶çš„æ•°æ®ï¼š&quot;</span> + event.<span class=\"property\">data</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">port2.<span class=\"property\">onmessage</span> = <span class=\"keyword\">function</span>(<span class=\"params\">event</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;port2æ”¶çš„æ•°æ®ï¼š&quot;</span> + event.<span class=\"property\">data</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">port1.<span class=\"title function_\">postMessage</span>(<span class=\"string\">&quot;port1å‘çš„æ•°æ®&quot;</span>);  <span class=\"comment\">// port2æ”¶çš„æ•°æ®ï¼šport1å‘çš„æ•°æ®</span></span><br><span class=\"line\">port2.<span class=\"title function_\">postMessage</span>(<span class=\"string\">&quot;port2å‘çš„æ•°æ®&quot;</span>);</span><br></pre></td></tr></table></figure>\n<h6 id=\"4.2-ä½¿ç”¨å…¶è¿›è¡Œæ·±æ‹·è´\">4.2 ä½¿ç”¨å…¶è¿›è¡Œæ·±æ‹·è´<a title=\"#4.2-ä½¿ç”¨å…¶è¿›è¡Œæ·±æ‹·è´\" href=\"#4.2-ä½¿ç”¨å…¶è¿›è¡Œæ·±æ‹·è´\"></a></h6>\n<p>MessageChannel çš„ postMessage ä¼ é€’æ•°æ®ä¹Ÿæ˜¯ æ·±æ‹·è´çš„ï¼Œä¸ web worker çš„postMessage ä¸€æ ·ï¼Œè€Œä¸”å¯ä»¥<strong>æ‹·è´ undefined å’Œ å¾ªç¯å¼•ç”¨çš„å¯¹è±¡</strong></p>\n<p>ä½†æ‹·è´<strong>æœ‰å‡½æ•°çš„å¯¹è±¡æ—¶ï¼Œä¼šæŠ¥é”™</strong>ã€‚è€Œä¸”æ˜¯åœ¨ <strong>å¼‚æ­¥</strong>çš„</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">deepcopy</span>(<span class=\"params\">obj</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123;port1, port2&#125; = <span class=\"keyword\">new</span> <span class=\"title class_\">MessageChannel</span>();</span><br><span class=\"line\">        <span class=\"comment\">// port2å°†port1 ä¼ è¿‡æ¥çš„ obj è¿”å›å‡ºå» objæ­¤æ—¶å°±æ˜¯æ·±æ‹·è´åçš„</span></span><br><span class=\"line\">        port2.<span class=\"property\">onmessage</span> = <span class=\"function\"><span class=\"params\">event</span> =&gt;</span> <span class=\"title function_\">resolve</span>(event.<span class=\"property\">data</span>); </span><br><span class=\"line\">        port1.<span class=\"title function_\">postMessage</span>(obj);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// copy å°±æ˜¯ä¼ å‡ºæ¥çš„ æ·±æ‹·è´åçš„å€¼</span></span><br><span class=\"line\"><span class=\"title function_\">deepcopy</span>(obj).<span class=\"title function_\">then</span>(<span class=\"function\">(<span class=\"params\">copy</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> copyobj = copy;  <span class=\"comment\">// copyobj å·²ç»ä¸ç­‰äº objäº† copy == copyobj ï¼= obj</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h5 id=\"5.-æ‰‹å†™å¾ªç¯é€’å½’\">5. æ‰‹å†™å¾ªç¯é€’å½’<a title=\"#5.-æ‰‹å†™å¾ªç¯é€’å½’\" href=\"#5.-æ‰‹å†™å¾ªç¯é€’å½’\"></a></h5>\n<blockquote>\n<p>åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡çš„å­—æ®µæ˜¯å¦å¼•ç”¨äº†è¿™ä¸ªå¯¹è±¡æˆ–è¿™ä¸ªå¯¹è±¡çš„ä»»æ„çˆ¶çº§ï¼Œå¦‚æœå¼•ç”¨äº†çˆ¶çº§ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›åŒçº§çš„æ–°å¯¹è±¡ï¼Œåä¹‹ï¼Œè¿›è¡Œé€’å½’çš„é‚£å¥—æµç¨‹ã€‚</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">deepCopy</span>(<span class=\"params\">obj, cache = <span class=\"keyword\">new</span> <span class=\"built_in\">WeakMap</span>()</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"title class_\">Object</span>.<span class=\"property\">prototypr</span>.<span class=\"property\">toString</span>.<span class=\"title function_\">call</span>(obj) === <span class=\"string\">&#x27;[object Function]&#x27;</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Function</span>(<span class=\"string\">&#x27;return &#x27;</span> + obj.<span class=\"title function_\">toString</span>()).<span class=\"title function_\">call</span>(<span class=\"variable language_\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(obj == <span class=\"literal\">null</span> || <span class=\"keyword\">typeof</span> obj !== <span class=\"string\">&#x27;object&#x27;</span>)&#123;  </span><br><span class=\"line\">        <span class=\"comment\">// == null åŒ…å«äº† null å’Œ undefined</span></span><br><span class=\"line\">        <span class=\"comment\">// typeof é™¤ function å¤–çš„å¼•ç”¨ç±»å‹éƒ½æ˜¯ object</span></span><br><span class=\"line\">        <span class=\"comment\">// æ‰€ä»¥ ä¸æ˜¯funcitonåˆä¸æ˜¯å…¶ä»–å¼•ç”¨ç±»å‹çš„è¯ å°±æ˜¯åŸºæœ¬æ•°æ®ç±»å‹äº†</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// ä»¥ä¸‹æ˜¯å¯¹ é™¤ function å¤–çš„å¼•ç”¨ç±»å‹çš„å¤„ç†</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"title class_\">Object</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">toString</span>.<span class=\"title function_\">call</span>(obj) === <span class=\"string\">&#x27;[object Date]&#x27;</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>(obj);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"title class_\">Objcet</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">toString</span>.<span class=\"title function_\">call</span>(obj) === <span class=\"string\">&#x27;[object RegExp]&#x27;</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RegExp</span>(obj);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"title class_\">Objcet</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">toString</span>.<span class=\"title function_\">call</span>(obj) === <span class=\"string\">&#x27;[object Error]&#x27;</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(obj);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(cache.<span class=\"title function_\">get</span>(obj))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cache.<span class=\"title function_\">get</span>(obj);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> copyObj = <span class=\"title class_\">Object</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">toString</span>.<span class=\"title function_\">call</span>(obj) === <span class=\"string\">&#x27;[object Array]&#x27;</span> ? [] : &#123;&#125;;</span><br><span class=\"line\">    <span class=\"comment\">// let copyObj = Array.isArray(obj) ? [] : &#123;&#125;;</span></span><br><span class=\"line\">    <span class=\"comment\">// let copyObj = new obj.constructor();</span></span><br><span class=\"line\">    cache.<span class=\"title function_\">set</span>(obj,copyObj); <span class=\"comment\">// æ­¤æ—¶ copyObj è¿˜æ²¡æœ‰æ•°æ®ï¼Œä¸‹é¢ä¼šè¿›è¡Œæ·»åŠ </span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">const</span> key <span class=\"keyword\">in</span> obj)&#123;</span><br><span class=\"line\">    \t<span class=\"keyword\">if</span>(obj.<span class=\"title function_\">hasOwnPrototype</span>(key))&#123;  <span class=\"comment\">// ç”¨for inä¸ºä»€ä¹ˆè¿˜è¦åˆ¤æ–­keyæ˜¯å¦ä¸ºobjçš„è‡ªèº«å±æ€§</span></span><br><span class=\"line\"><span class=\"comment\">// è¾‰å“¥è¯´ å› ä¸º for in éå†çš„æ˜¯ å¯è¿­ä»£çš„å˜é‡ï¼Œå½“åœ¨å…¶åŸå‹é“¾ä¸Šæ—¶ï¼Œä¹Ÿæ˜¯å¯è¿­ä»£çš„ï¼Œä½†æ˜¯å´ä¸æ˜¯æœ¬èº«å±æ€§</span></span><br><span class=\"line\">            <span class=\"comment\">// é€’å½’æ‹·è´</span></span><br><span class=\"line\">            copyObj[key] = <span class=\"title function_\">deepCopy</span>(obj[key],cache)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> copyObj;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","prev":{"title":"åˆ¤æ–­æ•°æ®ç±»å‹","link":"furtherNotes/further/01 åˆ¤æ–­æ•°æ®ç±»å‹"},"next":{"title":"å•é¡µé¢ã€å¤šé¡µé¢åº”ç”¨","link":"furtherNotes/further/06 å•é¡µé¢åº”ç”¨å’Œå¤šé¡µé¢åº”ç”¨"},"plink":"https://shylees.github.io/furtherNotes/further/01 æ·±æ‹·è´æµ…æ‹·è´/","toc":[{"id":"æ·±æ‹·è´-ä¸-æµ…æ‹·è´","title":"æ·±æ‹·è´ ä¸ æµ…æ‹·è´","index":"1","children":[{"id":"1.-æ•°æ®ç±»å‹å­˜å‚¨","title":"1. æ•°æ®ç±»å‹å­˜å‚¨","index":"1.1"},{"id":"2.-æµ…æ‹·è´","title":"2. æµ…æ‹·è´","index":"1.2"},{"id":"3.-æ·±æ‹·è´","title":"3. æ·±æ‹·è´","index":"1.3"}]}],"copyright":{"custom":"ä¸è®¸è½¬è½½ğŸ˜¡ï¼ï¼ï¼"},"reading_time":"1618 words in 8 min"}