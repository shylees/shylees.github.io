---
title: 浅浅了解闭包
date: 2022/3/2 11:49
updated: 2022/3/2 14:03
comments:
tags:
 - js
 - 闭包
categories:
 - workNotes
layout:
permalink:
meta: true
---

> 2022.03.02 周三
>
> 参考链接：https://github.com/lgwebdream/FE-Interview/issues/17


## 对闭包的看法，为什么要用闭包？说一下闭包原理以及应用场景

### 闭包是什么？

函数执行后返回结果是一个内部函数，并被外部变量所引用，如果内部函数持有被执行函数作用域的变量，就形成了闭包。

> 简而言之：可以在内部函数访问到外部函数的作用域。

使用闭包的作用：

1. 读取函数中的变量
2. 将函数中的变量存储在内存中，保护变量不被污染。
   > 因此，会对内存有消耗，所以不可以滥用闭包，否则会影响网页性能，造成内存泄漏。
   > 在不需要使用闭包时，要及时释放内存，可以将内层函数对象的变量赋值为 null

### 闭包原理

函数执行分成两个阶段：预编译阶段 和 执行阶段

1. 预编译阶段，如果发现内部函数使用了外部函数的变量，则会在内存中创建一个“闭包”对象并保存对应变量，如果已存在“闭包”，就只需要增加对应的属性值即可。
2. 执行完后，函数执行上下文会被销毁，函数对“闭包”对象的引用也会被销毁，但内部函数还持有该“闭包”的引用，所以内部函数可以继续使用外部函数中的变量

> 利用函数作用域链的特性，一个函数**内部定义的函数** 会将包含的 **外部函数的活动对象** 添加到它的作用域中，函数执行完毕，其函数执行作用域链销毁；但因为 **内部函数的作用域链** 仍然**在引用**这个活动对象，所以其活动对象不会被销毁，直至内部函数被销毁后才被销毁。

### 优点

- 可以从内部函数访问外部函数的作用域中的变量，且访问到的变量长期存储在内存中，可供后面使用
- 避免变量污染全局
- 把变量存在独立的作用域，作为私有成员存在

### 缺点

- 对内存消耗有负面影响，因内部函数保存了对外部变量的引用，导致无法被垃圾回收，增大内存使用量，所以使用不当会导致内存泄漏。
- 对处理速度具有负面影响。闭包的层级决定了引用的外部变量在查找时经过的作用域链的长度
- 可能获取到意外的值 captured value

### 应用场景

1. 模块封装；在各模块规范出现之前，都是用这样的方式防止变量污染全局

```js
var bar = function () {
  var foo = 0;
  function bar() {}
  bar.prototype.ddd = function ddd() {
    return foo;
  };
  return bar;
};
```

2. 在循环中创建闭包，防止取到意外的值

```js
function foo(num){
  return function(){
    console.log(num);
  }
}

for(var i = 0 ; i < 3 ; i++>){
  foo(i);
}
```
