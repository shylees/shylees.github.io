---
title: 长连接短链接 长轮询短轮询
date: 2022/3/27
updated: 2022/3/27
comments:
tags:
 - 网络
categories:
 - furtherNotes
layout:
permalink:
meta: true
---

> 参考链接：https://www.jianshu.com/p/3fc3646fad80

## 短链接

http1.0

每次http连接都要经历：发送请求 -> 建立tcp连接 -> 传输数据 -> 关闭tcp连接

## 长连接

http1.1

http connection = keep-alive，发送请求 -> 建立tcp长连接 -> 传输所有http请求及其响应数据 -> 在超时时间内 如果没有请求发送的话就断开连接



> HTTP协议说到底是应用层的协议，而TCP才是真正的传输层协议，只有负责传输的这一层才需要建立连接。
>
> 所以长短连接是指 tcp 连接

**Q1** 是不是只要设置Connection为keep-alive就算是长连接了？

**A1** 是的，但要服务器和客户端都设置。

> 都说HTTP1.1默认是长连接，而观察我们平时开发的Web应用的HTTP头部，Connection也确实是keep-alive，那就是说我们大部分都是用的长连接



**Q2** 我们平时用的是不是长连接？

**A2** 是的。（现在用的基本上都是HTTP1.1协议，你观察一下就会发现，基本上**Connection都是keep-alive**。而且HTTP协议文档上也提到了，HTTP1.1默认是长连接，也就是默认Connection的值就是keep-alive）



**Q3** 这种普通的Web应用（比如博客园，我的个人博客这种）用长连接有什么好处？需不需要关掉长连接而使用短连接？

**A3**  长连接是为了复用TCP连接，也就是说，长连接情况下，**多个HTTP请求可以**复用同一个TCP连接，这就节省了很多TCP连接建立和断开的消耗。

比如你请求了博客园的一个网页，这个网页里肯定还包含了CSS、JS等等一系列资源，如果你是短连接（也就是每次都要重新建立TCP连接）的话，那**你每打开一个网**页，基本**要建立几个甚至几十个TCP连接**，这浪费了多少资源就不用LZ去说了吧。

但如果是长连接的话，那么这么**多次HTTP请求**（这些请求包括请求网页内容，CSS文件，JS文件，图片等等），其实**使用的都是一个TCP连接**，很显然是可以节省很多消耗的。

长连接并不是永久连接的。如果一段时间内（具体的时间长短，是可以在header当中进行设置的，也就是所谓的**超时时间**），这个**连接没有HTTP请求发出的话，那么这个长连接就会被断掉**。



> 首先长连接是为了复用，比如说在请求这个博客的时候，建立了一条tcp连接，在传输完一个html文件后，连接就关闭了，如果还有后续的css文件就需要再开启一个tcp连接，but 如果用了长连接，再与改网站有关的资源还没传输完的时候一直保持着改连接，



## 短轮询

在一个需要实时更新数据的地方，比如说商品库存量:

用JS写个死循环，**不停的去请求服务器中的库存量是多少，然后刷新到这个页面当中**，这其实就是所谓的短轮询。**短轮询去服务端查询的时候，不管库存量有没有变化，服务器就立即返回结果了。**

坏处：那就是你很浪费服务器和客户端的资源，如果有1000个人停留在某个商品详情页面，那就是说会有1000个客户端不停的去请求服务器获取库存量，这显然是不合理的。

> 短轮询就是在不停得向后端发送请求查询库存量，后端每次都返回当前数据库的值给前端
>
> 如果在很多用户都看这个页面时，后台就要返回很多数据



## 长轮询

在一个需要实时更新数据的地方，比如说商品库存量:

其实长轮询和短轮询最大的区别是，短轮询去服务端查询的时候，不管库存量有没有变化，服务器就立即返回结果了。而长轮询则不是，在长轮询中**，服务器如果检测到库存量没有变化的话，将会把当前请求挂起**一段时间（这个时间也叫作**超时时间**，一般是几十秒）。在这个时间里，**服务器会去检测库存量有没有变化，检测到变化就立即返回，否则就一直等到超时为止。**

> 长轮询就是发送一个查询库存量的请求，但是后端是在数据库变化的时候才返回给前端



## 轮询和连接的区别

1. **决定的方式**，

   一个TCP连接是否为长连接，是通过设置**HTTP的Connection Header**来决定的，而且是需要**两边都设置**才有效。

   而一种轮询方式是否为长轮询，是根据**服务端的处理方式**来决定的，与客户端没有关系。

2. **实现的方式**，

   连接的长短是通过**协议**来规定和实现的。

   而轮询的长短，是**服务器通过编程**的方式手动挂起请求来实现的。

