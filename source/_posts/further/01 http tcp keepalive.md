---
title: http 与 tcp keep-alive 的区别
date: 2022/3/27
updated: 2022/3/27
comments:
tags:
 - 网络
categories:
 - furtherNotes
layout:
permalink:
meta: true
---

> 根据 连接轮询扩展
>
> 参考链接:
>
> https://www.jianshu.com/p/95af6727bf6c
>
> https://www.jianshu.com/p/cb36364ee099   – 详细

## HTTP keep-alive

>  决定tcp连接是长连接还是短连接



- HTTP是基于TCP传输协议实现的，**客户端与服务段要进行HTTP连接前，需要先建立TCP连接**，然后客户端发送HTTP请求，服务端收到后就返回响应，至此[请求-应答]完成，随后释放连接。

+ HTTP短连接：每次请求都经历一个建立TCP的连接。一次连接只能请求一次资源。

+ HTTP长连接：HTTP的keepalive实现了这个功能，可以使用同一个TCP连接来发送和接受多个HTTP请求/应答，避免连接建立释放的过程造成的资源消耗

- 特点：只要任意一端没有明确提出断开连接，则保持TCP连接。
- 为了避免资源浪费的情况，web服务器会提供超时连接的参数，用来指定HTTP长连接的超时时间。

## TCP keep-alive

+ 是由TCP内核层实现的，称为**TCP的保活机制**

+ 定义在一个时间段，在这个时间段内，如果**没有任何连接**的相关活动，**TCP保活机制会开始作用** —— 每隔一个时间段，发送一个探测报文，该探测报文包含的数据非常少，**如果连续几个探测报文都没有得到响应，则认为当前的TCP连接已经死亡**，系统内核将错误信息通知上层应用程序。
+ 如果对端程序是正常工作的。当TCP保活的探测报文发送给对端，对端会正常响应，这样TCP保活时间会被重置，等待下一个TCP保活时间的到来。
+ 如果对端程序崩溃，或对端由于其他原因导致报文不可达。当TCP保活的探测报文发送给对端后，石沉大海，没有响应，连续几次，达到保活探测次数后，TCP会报告该TCP连接已死亡。



